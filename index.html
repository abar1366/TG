<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø§Ø²ÛŒ Ø§Ø¹ØªÙ…Ø§Ø¯</title>
  <style>
    body {
      direction: rtl;
      font-family: sans-serif;
      background: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 1200px;
      margin-top: 50px;
    }
    .game-container, .sidebar {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .game-container { width: 60%; text-align: center; }
    .sidebar { width: 35%; text-align: center; }
    .players {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
    }
    .player, .agent {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .hat {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      margin-bottom: 5px;
    }
    .hat.red { background: red; }
    .hat.pink { background: pink; }
    .hat.black { background: black; }
    .hat.brown { background: goldenrod; }
    .hat.blue { background: blue; }
    .coin-buttons button, .action-buttons button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .scoreboard {
      margin-top: 15px;
      text-align: center;
    }
    .form-container input, .form-container select, .form-container button {
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    .negative {
      color: red;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="game-container" id="loginScreen">
      <h2>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ</h2>
      <div class="form-container">
        <label for="username">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</label>
        <input type="text" id="username" required>
        <label for="age">Ø³Ù†:</label>
        <input type="number" id="age" required>
        <label for="gender">Ø¬Ù†Ø³ÛŒØª:</label>
        <select id="gender" required>
          <option value="male">Ù…Ø±Ø¯</option>
          <option value="female">Ø²Ù†</option>
          <option value="other">Ø¯ÛŒÚ¯Ø±</option>
        </select>
        <button onclick="startGame()">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
      </div>
    </div>

    <div class="game-container" id="gameScreen" style="display:none;">
      <h2 id="roundInfo">Ø±Ø§Ù†Ø¯ 1 Ø§Ø² 5</h2>
      <div id="summaryScores"></div>
      <div class="players">
        <div class="player">
          <div class="hat red"></div>
          <div id="playerFace" style="font-size: 40px;">ğŸ˜Š</div>
          <strong>Ø¨Ø§Ø²ÛŒÚ©Ù†</strong>
        </div>
        <div class="agent">
          <div class="hat" id="agentHat"></div>
          <div id="agentFace" style="font-size: 40px;">ğŸ˜Š</div>
          <strong>Ø§ÛŒØ¬Ù†Øª</strong>
        </div>
      </div>
      <div id="coinSelection">
        <p>Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</p>
        <div class="coin-buttons">
          <button onclick="setCoins(10)">10</button>
          <button onclick="setCoins(50)">50</button>
          <button onclick="setCoins(100)">100</button>
        </div>
      </div>
      <div>
        <p>ØªØµÙ…ÛŒÙ… Ø´Ù…Ø§:</p>
        <div class="action-buttons" id="actionButtons" style="display:none">
          <button onclick="playRound('trust')">ğŸ¤ Ø§Ø¹ØªÙ…Ø§Ø¯</button>
          <button onclick="playRound('cheat')">âŒ ØªÙ‚Ù„Ø¨</button>
        </div>
      </div>
      <div id="resultText" style="margin-top:20px; white-space:pre-line;"></div>
      <div class="scoreboard">
        <table>
          <thead>
            <tr><th>Ù†ÙˆØ¹</th><th>Ø§Ù…ØªÛŒØ§Ø²</th></tr>
          </thead>
          <tbody>
            <tr><td>Ø¨Ø§Ø²ÛŒÚ©Ù†</td><td id="totalScoreDisplay">0</td></tr>
            <tr><td style="color:goldenrod">Ù‚Ù‡ÙˆÛŒÛŒ</td><td id="randomScore">0</td></tr>
            <tr><td style="color:pink">ØµÙˆØ±ØªÛŒ</td><td id="cooperatorScore">0</td></tr>
            <tr><td style="color:black">Ù…Ø´Ú©ÛŒ</td><td id="defectorScore">0</td></tr>
            <tr><td style="color:blue">Ø¢Ø¨ÛŒ</td><td id="titfortatScore">0</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="sidebar">
      <h3>ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø§Ø²ÛŒ</h3>
      <p>Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒ Ø´Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø§ÛŒØ¬Ù†Øª Ø§Ø¹ØªÙ…Ø§Ø¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ ØªÙ‚Ù„Ø¨ Ú©Ù†ÛŒØ¯. Ø¨Ø³ØªÙ‡ Ø¨Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù…Ø§ Ùˆ Ø§ÛŒØ¬Ù†ØªØŒ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ø¯Ø³Øª Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯. Ø³Ø¹ÛŒ Ú©Ù†ÛŒØ¯ Ø¯Ø± Ù†Ù‡Ø§ÛŒØª Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ø±Ø§ Ú©Ø³Ø¨ Ú©Ù†ÛŒØ¯.</p>
      <h3>Ù†Ø­ÙˆÙ‡ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ:</h3>
      <ul>
        <li><strong>Ø§Ú¯Ø± Ù‡Ø± Ø¯Ùˆ Ø§Ø¹ØªÙ…Ø§Ø¯ Ú©Ù†ÛŒØ¯(ğŸ¤):</strong> Ù‡Ø± Ú©Ø¯Ø§Ù… Ø³Ú©Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø±Ø¯.</li>
        <li><strong>Ø§Ú¯Ø± Ù‡Ø± Ø¯Ùˆ ØªÙ‚Ù„Ø¨ Ú©Ù†ÛŒØ¯(âŒ):</strong> Ù‡ÛŒÚ†â€Œ Ú©Ø¯Ø§Ù… Ø§Ø² Ø´Ù…Ø§ Ù‡ÛŒÚ† Ø³Ú©Ù‡â€ŒØ§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯.</li>
        <li><strong>Ø§Ú¯Ø± Ø´Ù…Ø§ ØªÙ‚Ù„Ø¨ Ú©Ù†ÛŒØ¯ Ùˆ Ø§ÛŒØ¬Ù†Øª Ø§Ø¹ØªÙ…Ø§Ø¯ Ú©Ù†Ø¯(âŒ, ğŸ¤):</strong> Ø´Ù…Ø§ Ø³Ù‡ Ø¨Ø±Ø§Ø¨Ø± Ø³Ú©Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ù¾Ø§Ø¯Ø§Ø´ Ø®ÙˆØ§Ù‡ÛŒØ¯ Ú¯Ø±ÙØªØŒ Ø§Ù…Ø§ Ø§ÛŒØ¬Ù†Øª Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ú©Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ØŒ Ø³Ú©Ù‡â€Œ Ø§Ø² Ø¯Ø³Øª Ù…ÛŒ Ø¯Ù‡Ø¯ </li>
        <li><strong>Ø§Ú¯Ø± Ø´Ù…Ø§ Ø§Ø¹ØªÙ…Ø§Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Ø§ÛŒØ¬Ù†Øª ØªÙ‚Ù„Ø¨ Ú©Ù†Ø¯(ğŸ¤, âŒ):</strong> Ø§ÛŒÙ†Ø¨Ø§Ø± Ø§ÛŒØ¬Ù†Øª Ø³Ù‡ Ø¨Ø±Ø§Ø¨Ø± Ø³Ú©Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾Ø§Ø¯Ø§Ø´ Ø®ÙˆØ§Ù‡Ø¯ Ú¯Ø±ÙØª Ùˆ Ø´Ù…Ø§ Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ú©Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ØŒ Ø³Ú©Ù‡ Ø§Ø² Ø¯Ø³Øª Ù…ÛŒ Ø¯Ù‡ÛŒØ¯ .</li>
      </ul>
    </div>
  </div>
<script>
let coins = 0;
let subRound = 1;
let currentAgentIndex = 0;
let totalScore = 0;
let startTime = 0;
let totalAgentScores = { random: 0, cooperator: 0, defector: 0, titfortat: 0 };
let lastPlayerChoice = 'trust';
const agentTypes = [
  { name: 'random', color: 'brown' },
  { name: 'cooperator', color: 'pink' },
  { name: 'defector', color: 'black' },
  { name: 'titfortat', color: 'blue' }
];
let currentAgent = agentTypes[currentAgentIndex];

function updateAgentVisual() {
  document.getElementById('agentHat').className = 'hat ' + currentAgent.color;
  document.getElementById('agentFace').textContent = 'ğŸ˜Š';
}

function setCoins(amount) {
  coins = amount;
  startTime = Date.now();
  document.getElementById('coinSelection').style.display = 'none';
  document.getElementById('actionButtons').style.display = 'block';
  document.getElementById('resultText').innerText = '';
  document.getElementById('playerFace').textContent = 'ğŸ˜Š';
  document.getElementById('agentFace').innerText = 'ğŸ˜Š';
}

function getAgentChoice() {
  if (currentAgent.name === 'cooperator') return 'trust';
  if (currentAgent.name === 'defector') return 'cheat';
  if (currentAgent.name === 'titfortat') return lastPlayerChoice;
  return Math.random() < 0.5 ? 'trust' : 'cheat';
}

function updateSummary() {
  const totalAgentScore = Object.values(totalAgentScores).reduce((a,b)=>a+b,0);
  document.getElementById('summaryScores').innerHTML = `
    <p><strong>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ø²ÛŒÚ©Ù†:</strong> <span class="${totalScore<0?'negative':''}">${totalScore}</span></p>
    <p><strong>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒØ¬Ù†Øªâ€ŒÙ‡Ø§:</strong> <span class="${totalAgentScore<0?'negative':''}">${totalAgentScore}</span></p>
  `;
}

function logToSheet(data) {
  fetch('https://script.google.com/macros/s/AKfycbwjcJ1boNGITkgnybIQMhYwV6HdSEh9ZhWUqXVk3AzBd6YgzfHOVge2Z9x22yBmBbB-IA/exec', {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
}

function playRound(playerChoice) {
  if (coins === 0) return alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
  const agentChoice = getAgentChoice();
  const responseTime = Date.now() - startTime;
  const minutes = Math.floor(responseTime / 60000);
  const seconds = ((responseTime % 60000) / 1000).toFixed(2);
  const responseText = (minutes + parseFloat(seconds) / 60).toFixed(2);
  lastPlayerChoice = playerChoice;
  updateAgentVisual();
  let playerReward = 0, agentReward = 0, resultText = '';
  if (playerChoice === 'trust' && agentChoice === 'trust') {
    playerReward = agentReward = coins;
    resultText = 'ğŸ¤ Ù‡Ø± Ø¯Ùˆ Ø§Ø¹ØªÙ…Ø§Ø¯ Ú©Ø±Ø¯Ù†Ø¯.';
    document.getElementById('playerFace').textContent = 'ğŸ¤—';
    document.getElementById('agentFace').textContent = 'ğŸ¤—';
  } else if (playerChoice === 'trust') {
    playerReward = -coins;
    agentReward = coins * 3;
    resultText = 'ğŸ˜­ Ø´Ù…Ø§ Ø§Ø¹ØªÙ…Ø§Ø¯ Ú©Ø±Ø¯ÛŒØ¯ ÙˆÙ„ÛŒ Ø§ÛŒØ¬Ù†Øª ØªÙ‚Ù„Ø¨ Ú©Ø±Ø¯.';
    document.getElementById('playerFace').textContent = 'ğŸ˜';
    document.getElementById('agentFace').textContent = 'ğŸ˜ˆ';
  } else if (agentChoice === 'trust') {
    playerReward = coins * 3;
    agentReward = -coins;
    resultText = 'ğŸ˜ˆ Ø´Ù…Ø§ ØªÙ‚Ù„Ø¨ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø§ÛŒØ¬Ù†Øª Ø§Ø¹ØªÙ…Ø§Ø¯ Ú©Ø±Ø¯.';
    document.getElementById('playerFace').textContent = 'ğŸ˜ˆ';
    document.getElementById('agentFace').textContent = 'ğŸ˜';
  } else {
    playerReward = agentReward = 0;
    resultText = 'ğŸ˜ Ù‡Ø± Ø¯Ùˆ ØªÙ‚Ù„Ø¨ Ú©Ø±Ø¯Ù†Ø¯.';
    document.getElementById('playerFace').textContent = 'ğŸ˜';
    document.getElementById('agentFace').textContent = 'ğŸ˜';
  }
  totalAgentScores[currentAgent.name] += agentReward;
  totalScore += playerReward;
  const totalAgentsScore = Object.values(totalAgentScores).reduce((a,b)=>a+b,0);
  const userData = {
    username: document.getElementById('username').value,
    age: document.getElementById('age').value,
    gender: document.getElementById('gender').value,
    round: subRound,
    agentType: currentAgent.name,
    playerChoice,
    agentChoice,
    coins,
    playerReward,
    agentReward,
    totalPlayerScore: totalScore,
    score_random: totalAgentScores.random,
    score_cooperator: totalAgentScores.cooperator,
    score_defector: totalAgentScores.defector,
    score_titfortat: totalAgentScores.titfortat,
    totalAgentsScore,
    responseTime: `${String(Math.floor(responseTime / 60000)).padStart(2, '0')}:${((responseTime % 60000) / 1000).toFixed(2).padStart(5, '0')}`
  };
  logToSheet(userData);
  document.getElementById('totalScoreDisplay').innerText = totalScore;
  document.getElementById('randomScore').innerText = totalAgentScores.random;
  document.getElementById('cooperatorScore').innerText = totalAgentScores.cooperator;
  document.getElementById('defectorScore').innerText = totalAgentScores.defector;
  document.getElementById('titfortatScore').innerText = totalAgentScores.titfortat;
  document.getElementById('resultText').innerText = resultText + `
ğŸ’° Ø§ÛŒØ¬Ù†Øª: ${agentReward}`;
  updateSummary();
  subRound++;
  if (subRound > 5) {
    subRound = 1;
    currentAgentIndex++;
    if (currentAgentIndex < agentTypes.length) {
      currentAgent = agentTypes[currentAgentIndex];
      updateAgentVisual();
      document.getElementById('roundInfo').innerText = 'Ø±Ø§Ù†Ø¯ ' + subRound + ' Ø§Ø² 5';
      document.getElementById('resultText').innerText = 'ğŸ© Ø§ÛŒØ¬Ù†Øª Ø¬Ø¯ÛŒØ¯ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.';
      document.getElementById('coinSelection').style.display = 'block';
      document.getElementById('actionButtons').style.display = 'none';
      coins = 0;
    } else {
      document.getElementById('roundInfo').innerText = 'Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯ âœ…';
      document.getElementById('actionButtons').style.display = 'none';
      document.querySelector('.coin-buttons').style.display = 'none';
    }
  } else {
    document.getElementById('roundInfo').innerText = 'Ø±Ø§Ù†Ø¯ ' + subRound + ' Ø§Ø² 5';
  }
}

function startGame() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'block';
  updateAgentVisual();
  updateSummary();
}
</script>
</body>
</html>
